<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <!-- Política de Seguridad Permisiva para desarrollo -->
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: gap: content:">
    
    <title>Cámara Debug</title>
    <style>
        body {
            background-color: #121212;
            color: white;
            font-family: monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        h2 { margin-top: 0; }

        #marco-foto {
            width: 100%;
            height: 50%;
            background-color: #1e1e1e;
            border: 2px dashed #444;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            overflow: hidden;
        }

        #mi-imagen {
            max-width: 100%;
            max-height: 100%;
            display: none;
        }

        #btn-foto {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            width: 100%;
            max-width: 300px;
            cursor: pointer;
            /* Deshabilitado hasta que cargue cordova */
            opacity: 0.5; 
            pointer-events: none;
        }

        /* Consola visual para ver errores en el celular */
        #consola-debug {
            margin-top: 20px;
            width: 100%;
            height: 150px;
            background-color: #000;
            border: 1px solid #333;
            padding: 10px;
            overflow-y: scroll;
            font-size: 0.8rem;
            color: #0f0; /* Letras verdes tipo hacker */
            text-align: left;
        }
    </style>
</head>
<body>

    <h2>Prueba de Cámara</h2>

    <div id="marco-foto">
        <span id="placeholder">La foto aparecerá aquí</span>
        <img id="mi-imagen" src="" />
    </div>

    <button id="btn-foto">INICIANDO...</button>

    <!-- Área de logs para saber qué falla -->
    <div id="consola-debug">Iniciando logs...<br></div>

    <!-- Scripts -->
    <script src="cordova.js"></script>
    <script>
        // Función para escribir en la pantallita negra de abajo
        function log(msg) {
            const consola = document.getElementById('consola-debug');
            const linea = document.createElement('div');
            linea.textContent = "> " + msg;
            consola.appendChild(linea);
            consola.scrollTop = consola.scrollHeight; // Auto scroll
        }

        // Capturar errores globales de JavaScript
        window.onerror = function(message, source, lineno, colno, error) {
            log("ERROR CRÍTICO: " + message);
        };

        const btn = document.getElementById('btn-foto');
        const img = document.getElementById('mi-imagen');
        const placeholder = document.getElementById('placeholder');

        // 1. Evento DeviceReady (Fundamental según tu documentación)
        document.addEventListener('deviceready', function() {
            log("✅ Cordova 'deviceready' disparado.");
            
            // Habilitar botón
            btn.style.opacity = "1";
            btn.style.pointerEvents = "auto";
            btn.innerText = "TOMAR FOTO";
            
            // Comprobar plugin
            if (navigator.camera) {
                log("✅ Plugin navigator.camera DETECTADO.");
            } else {
                log("❌ ERROR: navigator.camera NO existe. ¿Se instaló el plugin?");
                btn.style.backgroundColor = "red";
                btn.innerText = "ERROR PLUGIN";
            }

        }, false);

        // 2. Agregar evento Click (Mejor que onclick="")
        btn.addEventListener('click', function() {
            log("Botón presionado.");

            if (!navigator.camera) {
                log("❌ No puedo abrir cámara (Plugin no encontrado).");
                return;
            }

            log("Intentando abrir cámara...");

            // Opciones estándar
            const options = {
                quality: 50,
                destinationType: Camera.DestinationType.DATA_URL, // Devuelve base64
                encodingType: Camera.EncodingType.JPEG,
                mediaType: Camera.MediaType.PICTURE,
                correctOrientation: true,
                saveToPhotoAlbum: false
            };

            navigator.camera.getPicture(onSuccess, onFail, options);
        });

        function onSuccess(imageData) {
            log("✅ ¡FOTO TOMADA CON ÉXITO!");
            img.src = "data:image/jpeg;base64," + imageData;
            img.style.display = "block";
            placeholder.style.display = "none";
        }

        function onFail(message) {
            log("⚠️ Falló la cámara: " + message);
        }

        log("Esperando a Cordova...");
    </script>
</body>
</html>
